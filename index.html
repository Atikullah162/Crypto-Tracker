<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crypto Tracker</title>

  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body { margin:0; background:#000000; color:#ebebeb; font-family:sans-serif; }
    .header { background:#2c2c27; padding:12px; text-align:center; font-weight:bold; border-bottom:3px solid #ffd000; }
    .container { max-width:1200px; margin:20px auto; padding:0 16px; display:grid; grid-template-columns:1fr; gap:16px; }
    .card { background:#27282c; border:1px solid #1f1f22; border-radius:12px; padding:12px; }
    .table { width:100%; border-collapse:collapse; }
    .th, .td { padding:8px; border-bottom:1px dashed #1f1f22; text-align:left; }
    .th { color:#c9c9c9; font-size:13px; text-transform:uppercase; }
    .chip { padding:2px 6px; border-radius:999px; font-size:12px; }
    .up { color:#27e08a; border:1px solid rgba(39,224,138,0.35); }
    .down { color:#ff4d4d; border:1px solid rgba(255,77,77,0.35); }
    .watch { cursor:pointer; }
    input { padding:8px; width:100%; margin-bottom:12px; border-radius:8px; border:1px solid #1f1f22; }
  </style>
</head>
<body>

  <div class="header">Crypto Tracker</div>
  <div class="container" id="app"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [coins, setCoins] = useState([]);
      const [loading, setLoading] = useState(true);
      const [search, setSearch] = useState("");
      const [selectedCoin, setSelectedCoin] = useState(null);
      const [coinDetails, setCoinDetails] = useState(null);

      useEffect(() => {
        async function fetchData() {
          try {
            const res = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1');
            const data = await res.json();
            setCoins(data);
            setLoading(false);
          } catch (e) {
            console.error('Error fetching data', e);
          }
        }
        fetchData();
      }, []);

      const fetchCoinDetails = async (id) => {
        try {
          const res = await fetch(`https://api.coingecko.com/api/v3/coins/${id}`);
          const data = await res.json();
          setCoinDetails(data);
        } catch (e) {
          console.error('Error fetching coin details', e);
        }
      }

      const filteredCoins = coins.filter(c => c.name.toLowerCase().includes(search.toLowerCase()) || c.symbol.toLowerCase().includes(search.toLowerCase()));

      if (loading) return <div className="card">Loading...</div>;

      return (
        <div>
          <div className="card">
            <input
              type="text"
              placeholder="Search coin..."
              value={search}
              onChange={e => setSearch(e.target.value)}
            />
            <table className="table">
              <thead>
                <tr>
                  <th className="th">#</th>
                  <th className="th">Coin</th>
                  <th className="th">Price</th>
                  <th className="th">24h %</th>
                  <th className="th">Market Cap</th>
                </tr>
              </thead>
              <tbody>
                {filteredCoins.map((c, i) => (
                  <tr key={c.id} className="watch" onClick={() => { setSelectedCoin(c); fetchCoinDetails(c.id); }}>
                    <td className="td">{i+1}</td>
                    <td className="td">{c.name} ({c.symbol.toUpperCase()})</td>
                    <td className="td">${c.current_price.toLocaleString()}</td>
                    <td className={`td chip ${c.price_change_percentage_24h>=0?'up':'down'}`}>
                      {c.price_change_percentage_24h.toFixed(2)}%
                    </td>
                    <td className="td">${c.market_cap.toLocaleString()}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {selectedCoin && coinDetails && (
            <div style={{
              position:"fixed", top:0, left:0, width:"100%", height:"100%", background:"rgba(0,0,0,0.7)",
              display:"flex", alignItems:"center", justifyContent:"center", zIndex:1000
            }}>
              <div style={{background:"#212125", padding:"20px", borderRadius:"12px", maxWidth:"500px", width:"90%", color:"#ffe8e8"}}>
                <button onClick={() => { setSelectedCoin(null); setCoinDetails(null); }} style={{float:"right", background:"none", border:"none", color:"#ff4d4d", fontSize:"18px", cursor:"pointer"}}>Ã—</button>
                <div style={{textAlign:"center"}}>
                  <img src={coinDetails.image.large} alt={coinDetails.name} style={{width:"64px", height:"64px"}} />
                  <h2>{coinDetails.name} ({coinDetails.symbol.toUpperCase()})</h2>
                  <p>Price: ${coinDetails.market_data.current_price.usd.toLocaleString()}</p>
                  <p>24h Change: <span className={coinDetails.market_data.price_change_percentage_24h>=0?'up':'down'}>
                    {coinDetails.market_data.price_change_percentage_24h.toFixed(2)}%
                  </span></p>
                  <p>Market Cap: ${coinDetails.market_data.market_cap.usd.toLocaleString()}</p>
                  <p style={{marginTop:"12px", fontSize:"14px"}} dangerouslySetInnerHTML={{__html: coinDetails.description.en.split('. ')[0]+'.'}}></p>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('app'));
  </script>

</body>
</html>
